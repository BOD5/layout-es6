import '../scss/_card.scss';

class Card extends HTMLElement {
  connectedCallback() {
    this.#render();
  }

  #render() {
    const star = (active) => {
      const color = (active) ? '#FA8C16' : '#C4C4C4';
      return `
        <svg width="25" height="23" viewBox="0 0 25 23" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M23.3439 8.64688L16.4014 7.6379L13.2978 1.3461C13.2131 1.17384 13.0736 1.03439 12.9014 0.94962C12.4693 0.736338 11.9443 0.914073 11.7283 1.3461L8.6248 7.6379L1.68222 8.64688C1.49082 8.67423 1.31582 8.76446 1.18183 8.90118C1.01985 9.06767 0.930594 9.29165 0.933671 9.52391C0.936747 9.75618 1.03191 9.97772 1.19824 10.1399L6.22129 15.0371L5.03457 21.9524C5.00674 22.1132 5.02454 22.2787 5.08595 22.4299C5.14736 22.5812 5.24993 22.7122 5.38202 22.8081C5.51411 22.9041 5.67044 22.9611 5.83328 22.9727C5.99612 22.9843 6.15895 22.9501 6.30332 22.8738L12.5131 19.609L18.7228 22.8738C18.8924 22.9641 19.0893 22.9942 19.2779 22.9613C19.7537 22.8793 20.0736 22.4281 19.9916 21.9524L18.8049 15.0371L23.8279 10.1399C23.9646 10.0059 24.0549 9.83087 24.0822 9.63946C24.1561 9.16095 23.8225 8.71798 23.3439 8.64688ZM16.6912 14.3481L17.6783 20.0984L12.5131 17.3859L7.34785 20.1012L8.33496 14.3508L4.15683 10.2766L9.93183 9.43712L12.5131 4.20626L15.0943 9.43712L20.8693 10.2766L16.6912 14.3481Z" fill="${color}"/>
          <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path opacity="0.2" d="M8.51445 0.206177L5.9332 5.43704L0.158203 6.27649L4.33633 10.3507L3.34922 16.1011L8.51445 13.3859L13.6797 16.0984L12.6926 10.348L16.8707 6.27649L11.0957 5.43704L8.51445 0.206177Z" fill="${color}"/>
          </svg>
        </svg>
      `;
    };

    const stars = [1, 2, 3, 4, 5].reduce((state, v, ind) => state + star((ind + 1) < (this.dataset.rating / 2)), '');

    const simple = this.hasAttribute('simple');

    const seperator = `
      <svg width="6" height="8" viewBox="0 0 6 8" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0.965221 0.464466L4.50076 4L0.965221 7.53553" stroke="black"/>
      </svg>
    `;

    this.innerHTML = `
      <article class="card">
        <div class="card__header">
          <div class="flag">
            <svg width="39" height="53" viewBox="0 0 39 53" xmlns="http://www.w3.org/2000/svg">
              <path d="M39 53L19.505 42.9621L0 53V7.92992V0H19.505H39V7.92992V53Z"/>
            </svg>
            <div>
              <svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.4103 7.78751L15.4678 6.77853L12.3643 0.486729C12.2795 0.314463 12.14 0.17501 11.9678 0.0902445C11.5357 -0.123037 11.0107 0.0546976 10.7947 0.486729L7.69121 6.77853L0.748629 7.78751C0.557223 7.81485 0.382223 7.90509 0.248239 8.04181C0.0862588 8.20829 -0.00299936 8.43228 7.69615e-05 8.66454C0.00315328 8.8968 0.0983124 9.11834 0.264645 9.28048L5.28769 14.1777L4.10097 21.093C4.07314 21.2538 4.09094 21.4193 4.15236 21.5705C4.21377 21.7218 4.31634 21.8528 4.44843 21.9488C4.58052 22.0447 4.73684 22.1017 4.89968 22.1133C5.06252 22.1249 5.22536 22.0907 5.36972 22.0145L11.5795 18.7496L17.7893 22.0145C17.9588 22.1047 18.1557 22.1348 18.3443 22.102C18.8201 22.0199 19.14 21.5688 19.058 21.093L17.8713 14.1777L22.8943 9.28048C23.0311 9.14649 23.1213 8.97149 23.1486 8.78009C23.2225 8.30157 22.8889 7.8586 22.4103 7.78751ZM15.7576 13.4887L16.7447 19.2391L11.5795 16.5266L6.41425 19.2418L7.40136 13.4914L3.22324 9.4172L8.99824 8.57774L11.5795 3.34688L14.1607 8.57774L19.9357 9.4172L15.7576 13.4887Z"/>
              </svg>
            </div>
          </div>
          <div class="visit">
            <svg width="82" height="82" viewBox="0 0 82 82" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 0H75C78.866 0 82 3.13401 82 7V82L0 0Z" fill="#F1F1F1"/>
            </svg>
            <a href="${this.dataset.link}">
              <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.6569 0C11.2705 0 10.8998 0.153517 10.6266 0.42678C10.3533 0.700043 10.1998 1.07067 10.1998 1.45712C10.1998 1.84357 10.3533 2.21419 10.6266 2.48746C10.8998 2.76072 11.2705 2.91424 11.6569 2.91424H15.425L6.25539 12.0839C6.11622 12.2183 6.00521 12.3791 5.92885 12.5569C5.85248 12.7346 5.81228 12.9258 5.8106 13.1193C5.80892 13.3128 5.84579 13.5047 5.91905 13.6837C5.99232 13.8628 6.10051 14.0255 6.23733 14.1623C6.37414 14.2991 6.53683 14.4073 6.7159 14.4806C6.89498 14.5538 7.08685 14.5907 7.28033 14.589C7.4738 14.5873 7.665 14.5472 7.84278 14.4708C8.02055 14.3944 8.18134 14.2834 8.31575 14.1442L17.4854 4.9746V8.74271C17.4854 9.12916 17.6389 9.49978 17.9122 9.77305C18.1854 10.0463 18.5561 10.1998 18.9425 10.1998C19.329 10.1998 19.6996 10.0463 19.9729 9.77305C20.2461 9.49978 20.3996 9.12916 20.3996 8.74271V1.45712C20.3996 1.07067 20.2461 0.700043 19.9729 0.42678C19.6996 0.153517 19.329 0 18.9425 0H11.6569Z"/>
                <path d="M2.91424 2.91418C2.14133 2.91418 1.40009 3.22122 0.85356 3.76774C0.307035 4.31427 0 5.05552 0 5.82842V17.4854C0 18.2583 0.307035 18.9995 0.85356 19.546C1.40009 20.0926 2.14133 20.3996 2.91424 20.3996H14.5712C15.3441 20.3996 16.0853 20.0926 16.6319 19.546C17.1784 18.9995 17.4854 18.2583 17.4854 17.4854V13.114C17.4854 12.7276 17.3319 12.3569 17.0586 12.0837C16.7854 11.8104 16.4148 11.6569 16.0283 11.6569C15.6419 11.6569 15.2712 11.8104 14.998 12.0837C14.7247 12.3569 14.5712 12.7276 14.5712 13.114V17.4854H2.91424V5.82842H7.28559C7.67204 5.82842 8.04267 5.6749 8.31593 5.40164C8.58919 5.12838 8.74271 4.75775 8.74271 4.3713C8.74271 3.98485 8.58919 3.61423 8.31593 3.34096C8.04267 3.0677 7.67204 2.91418 7.28559 2.91418H2.91424Z"/>
              </svg>
            </a>
          </div>
        </div>
        <div class="card__logo">
          <img src="${this.dataset.preview_image}" alt="">
        </div>
        <h3 class="card__name">
          ${this.dataset.name}
        </h3>
        <p class="card__preview">
          ${this.dataset.preview_text}
        </p>
        ${(simple) ? '' : `
            <div class="stars">
              ${stars}
            </div>`}
        
        <div class="inline">
          <svg width="21" height="22" viewBox="0 0 21 22" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M8.74164 11.9921L13.558 14.8894L13.6661 14.8065C14.3641 14.2708 15.2491 13.95 16.2135 13.95C18.4772 13.95 20.2992 15.7144 20.2992 17.875C20.2992 20.0355 18.4772 21.7999 16.2135 21.7999C13.9498 21.7999 12.1278 20.0355 12.1278 17.8749C12.1277 17.5889 12.1601 17.3036 12.2243 17.0243L12.2568 16.8829L7.44048 13.9855L7.33238 14.0684C6.63431 14.6041 5.74929 14.925 4.78493 14.925C2.5212 14.925 0.699219 13.1605 0.699219 11C0.699219 8.83938 2.5212 7.07495 4.78493 7.07495C5.74929 7.07495 6.63431 7.39584 7.33238 7.93146L7.44048 8.0144L12.2568 5.11704L12.2243 4.97562C12.1613 4.70171 12.1278 4.41717 12.1278 4.12495C12.1278 1.96438 13.9498 0.199951 16.2135 0.199951C18.4772 0.199951 20.2992 1.96438 20.2992 4.12495C20.2992 6.28552 18.4772 8.04995 16.2135 8.04995C15.2491 8.04995 14.3641 7.72906 13.6661 7.19341L13.558 7.11046L8.74164 10.0078L8.77412 10.1492C8.90284 10.7096 8.90284 11.2903 8.77412 11.8507L8.74164 11.9921Z" fill="#E5E5E5"/>
          </svg>
          <div class="card__tags">
            ${this.dataset.category}
          </div>
          <svg width="31" height="20" viewBox="0 0 31 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M24.7638 10.0001L17.8438 3.08005L20.4996 0.424316L30.0753 10.0001L20.4996 19.5758L17.8438 16.92L24.7638 10.0001ZM13.1553 3.08005L6.2353 10.0001L13.1553 16.92L10.4996 19.5758L0.923828 10.0001L10.4996 0.424316L13.1553 3.08005Z" fill="#E5E5E5"/>
          </svg>
        </div>
        <div class="card__disclamer">
          <div>
            <p> Min Investment: <mark>$${this.dataset.minimal_investment}</mark> </p>
            <p class="filters">${this.dataset.comission} ${seperator} ${this.dataset.investment_time} ${seperator} ${this.dataset.investor_type} </p>
          </div>
          <hr>
          <div>
            <p> Target return: <mark>${this.dataset.target_return !== 'null' ? `${this.dataset.target_return}%` : ''}</mark> </p>
            <p class="filters"> ${this.dataset.dividend} ${seperator} ${this.dataset.payout} ${seperator} ${this.dataset.liquidity} </p>
          </div>
        </div>
        ${(simple) ? '' : `
            <a href="catalog/${this.dataset.slug}">
              <button>Details</button>
            </a>`}
      </article>`;
  }
}

export default Card;
